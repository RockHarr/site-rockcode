<!doctype html>
<html lang="es"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Demo B — FormKit Gobierno</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head><body class="p-3">
<a class="btn btn-link" href="/">← Volver</a>
<h1 class="h3">FormKit Gobierno</h1>
<p class="text-muted">Multistep + guardado local + exportar a PDF.</p>
<form id="form" class="mt-3">
  <fieldset class="border rounded p-3">
    <legend class="float-none w-auto px-2 h6">Paso 1: Datos</legend>
    <div class="mb-3"><label for="rut" class="form-label">RUT</label><input id="rut" class="form-control" required></div>
    <div class="mb-3"><label for="nombre" class="form-label">Nombre</label><input id="nombre" class="form-control" required></div>
    <button class="btn btn-primary" type="button" id="guardar">Guardar y continuar</button>
  </fieldset>
</form>
<div class="mt-3 d-flex gap-2">
  <button class="btn btn-outline-secondary" id="reanudar">Reanudar</button>
  <button class="btn btn-success" id="pdf">Exportar PDF</button>
</div>
<script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script>
(() => {
  const STORAGE_KEY = 'formkit-v1';

  // Restaura automáticamente al cargar
  document.addEventListener('DOMContentLoaded', () => {
    try {
      const data = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
      for (const [name, value] of Object.entries(data)) {
        const el = document.querySelector(`[name="${CSS.escape(name)}"]`);
        if (!el) continue;
        if (el.type === 'checkbox' || el.type === 'radio') {
          const boxes = document.querySelectorAll(`[name="${CSS.escape(name)}"]`);
          boxes.forEach(b => b.checked = Array.isArray(value) ? value.includes(b.value) : b.value === value);
        } else {
          el.value = value;
        }
      }
    } catch {}
  });

  // Auto-guardado en cada cambio
  function snapshot() {
    const data = {};
    document.querySelectorAll('input[name], select[name], textarea[name]').forEach(el => {
      if (el.type === 'checkbox') {
        const boxes = [...document.querySelectorAll(`input[type="checkbox"][name="${el.name}"]`)];
        data[el.name] = boxes.filter(b => b.checked).map(b => b.value);
      } else if (el.type === 'radio') {
        const checked = document.querySelector(`input[type="radio"][name="${el.name}"]:checked`);
        if (checked) data[el.name] = checked.value;
      } else {
        data[el.name] = el.value;
      }
    });
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
  }

  // Escucha cambios y también avance de paso
  document.addEventListener('input', snapshot, true);
  document.addEventListener('change', snapshot, true);

  // Botón “Reiniciar” (si existe) para limpiar
  document.querySelector('[data-clear]')?.addEventListener('click', () => {
    localStorage.removeItem(STORAGE_KEY);
  });
})();
</script>

</body></html>
