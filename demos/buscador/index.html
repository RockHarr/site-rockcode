<!doctype html>
<html lang="es">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Buscador de Trámites — Demo</title>
<link rel="icon" href="/assets/favicon.ico" sizes="any">
<link rel="apple-touch-icon" href="/assets/apple-touch-icon.png">
<meta name="theme-color" content="#0b0e12">
<style>
  :root { --bg:#0b0e12; --card:#0f1319; --text:#e9ecef; --muted:#8a8f98; --accent:#4cc9f0; --border:#1b212a; }
  @media (prefers-reduced-motion:no-preference){ *{scroll-behavior:smooth} .hit{transition:transform .12s ease} .hit:focus{transform:scale(1.01)} }
  body{margin:0;font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial;color:var(--text);background:var(--bg)}
  .wrap{max-width:900px;margin:auto;padding:32px}
  h1{font-size:1.8rem;margin:0 0 6px}
  .muted{color:var(--muted)}
  .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:18px}
  input[type="search"]{width:100%;padding:14px 16px;border-radius:12px;border:1px solid var(--border);background:#0c1117;color:var(--text)}
  input[type="search"]:focus{outline:3px solid #2a3646}
  .row{display:grid;gap:12px;margin-top:14px}
  .hit{display:block;padding:14px 16px;border-radius:12px;border:1px solid var(--border);background:#0c1117;text-decoration:none;color:var(--text)}
  .hit:focus{outline:3px solid #2a3646}
  .k{font-size:.9rem;color:var(--muted)}
  mark{background:transparent;color:var(--accent);font-weight:600}
  .pill{display:inline-block;padding:.25rem .6rem;border:1px solid var(--border);border-radius:999px;color:var(--muted);font-size:.8rem}
</style>
<body>
<a class="pill" href="/" style="position:absolute;left:-9999px" id="skip" tabindex="0">Saltar a resultados</a>
<div class="wrap">
  <header style="margin-bottom:16px">
    <h1>Buscador de Trámites</h1>
    <p class="muted">Escribe el nombre del trámite. Soporta <em>sinónimos</em> y sugiere mientras escribes.</p>
  </header>

  <section class="card" aria-labelledby="lbl-busqueda">
    <label id="lbl-busqueda" class="muted" for="q">Buscar</label>
    <input id="q" type="search" placeholder="Ej: certificado de antecedentes, permiso de circulación, cambio de domicilio…"
           autocomplete="off" spellcheck="false" aria-describedby="help" />
    <div id="help" class="k" style="margin-top:6px">Tab/Shift+Tab navega; Enter abre el trámite.</div>
  </section>

  <section aria-labelledby="lbl-res" style="margin-top:16px">
    <h2 id="lbl-res" class="muted" style="font-size:1rem;margin:0 0 8px">Resultados</h2>
    <div id="results" class="row" role="list" aria-live="polite" aria-busy="false"></div>
  </section>
</div>

<script>
/* Dataset mínimo con sinónimos */
const DATA = [
  { id:1, titulo:"Certificado de antecedentes", alias:["antecedentes","certificado antecedentes","papeles antecedentes"], url:"https://www.registrocivil.cl/" },
  { id:2, titulo:"Permiso de circulación", alias:["pago patente","permiso auto","permiso vehicular"], url:"https://www.muniprovidencia.cl/" },
  { id:3, titulo:"Cambio de domicilio electoral", alias:["domicilio servel","cambio direccion voto","servel"], url:"https://www.servel.cl/" },
  { id:4, titulo:"Duplicado de cédula de identidad", alias:["reposición carnet","cedula perdida","carnet"], url:"https://www.registrocivil.cl/" },
  { id:5, titulo:"Licencia de conducir clase B", alias:["licencia manejar","renovar licencia","clase b"], url:"https://www.mtt.gob.cl/" }
];

const norm = s => s.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim();
const qs = id => document.querySelector(id);
const resEl = qs("#results"), qEl = qs("#q"), skip = qs("#skip");

function match(q){
  const nq = norm(q);
  if(!nq) return DATA;
  return DATA.filter(it=>{
    const hay = [it.titulo, ...(it.alias||[])].some(txt => norm(txt).includes(nq));
    return hay;
  }).slice(0,12);
}

function hi(txt,q){
  const nq = norm(q); if(!nq) return txt;
  const rx = new RegExp(`(${nq.replace(/[.*+?^${}()|[\]\\]/g,'\\$&')})`,"ig");
  return txt.replace(rx, "<mark>$1</mark>");
}

function render(list,q){
  resEl.innerHTML = "";
  if(list.length===0){
    const div = document.createElement("div");
    div.className="hit";
    div.setAttribute("role","listitem");
    div.innerHTML = `Sin resultados para <em>${q}</em>. Prueba con otro término.`;
    resEl.appendChild(div);
    return;
  }
  list.forEach(it=>{
    const a = document.createElement("a");
    a.className="hit"; a.href=it.url; a.target="_blank"; a.rel="noopener";
    a.setAttribute("role","listitem");
    a.innerHTML = `<strong>${hi(it.titulo,q)}</strong><div class="k">${(it.alias||[]).slice(0,2).join(" · ")}</div>`;
    resEl.appendChild(a);
  });
}

/* Accesibilidad: aria-live + skip link */
qEl.addEventListener("input", e=>{
  resEl.setAttribute("aria-busy","true");
  const list = match(e.target.value);
  render(list, e.target.value);
  resEl.setAttribute("aria-busy","false");
});
qEl.addEventListener("keydown", e=>{
  if(e.key==="ArrowDown"){ const first = resEl.querySelector(".hit"); if(first){ first.focus(); e.preventDefault(); } }
});
resEl.addEventListener("keydown", e=>{
  const items = [...resEl.querySelectorAll(".hit")];
  const i = items.indexOf(document.activeElement);
  if(e.key==="ArrowDown" && i>=0){ const nxt=items[i+1]||items[i]; nxt.focus(); e.preventDefault(); }
  if(e.key==="ArrowUp" && i>0){ const prv=items[i-1]; prv.focus(); e.preventDefault(); }
});
/* Inicial */
render(DATA,"");
skip.addEventListener("focus",()=>resEl.scrollIntoView({block:"start"}));
</script>
</html>
